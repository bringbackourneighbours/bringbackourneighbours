---
import { mapStaticPathsForStandalone } from '../../../util/map-static-paths-for-standalone';
import {
  SupportedLanguages,
  type LanguagesValue,
} from '../../../model/languages';
import { useUiTranslation } from '../../../content/use-ui-translation.ts';
import OverviewLayout from '../../../layouts/OverviewLayout.astro';
import Stack from '../../../components/design/Stack.astro';
import CardLink from '../../../components/design/CardLink.astro';
import { getCanonicalUrlToKit } from '../../../util/get-canonical-url';
import MoreInfoStack from '../../../components/MoreInfoStack.astro';
import { getTranslationsUrlsForPath } from '../../../util/get-translations-url';
import LanguageSwitcher from '../../../components/design/LanguageSwitcher.astro';
import { getCollection } from 'astro:content';
import type { StandaloneContentProps } from '../../../model/standalone-collections.ts';

interface Props {
  lang: LanguagesValue;
}

export async function getStaticPaths() {
  return Object.values(SupportedLanguages).map((lang) => {
    return {
      params: { lang },
      props: { lang },
    };
  });
}

const { lang } = Astro.props;

const allKits: StandaloneContentProps<'kits'>[] = mapStaticPathsForStandalone(
  await getCollection('kits'),
);

const translationSlugs = await getTranslationsUrlsForPath(lang, 'kit');
---

<OverviewLayout
  lang={lang}
  title=`${await useUiTranslation('meta.title', lang)} | ${await useUiTranslation('meta.subtitle', lang)}`
  translationSlugs={translationSlugs}
>
  <LanguageSwitcher
    lang={lang}
    translationSlugs={translationSlugs}
  />
  <h2>{useUiTranslation('meta.allKits', lang)}:</h2>
  <Stack>
    {
      allKits
        .filter((kit) => kit.params.lang === lang)
        .map(async (kit) => (
          <CardLink
            lang={lang}
            href={await getCanonicalUrlToKit(kit.props.entry, lang)}
          >
            {kit.props.entry.data.title}
          </CardLink>
        ))
    }
  </Stack>

  <MoreInfoStack
    lang={lang}
    showFlyers={true}
  />
</OverviewLayout>
