---
import {
  DEFAULT_LANG,
  type LanguagesValue,
  SupportedLanguages,
} from '../../model/languages';
import { useUiTranslation } from '../../content/use-ui-translation.ts';
import { getCanonicalUrlToKit } from '../../util/get-canonical-url';
import { getTranslationsUrlsForPath } from '../../util/get-translations-url';

import CardLink from '../../components/design/CardLink.astro';
import LanguageSwitcher from '../../components/design/LanguageSwitcher.astro';
import MoreInfoStack from '../../components/MoreInfoStack.astro';
import OverviewLayout from '../../layouts/OverviewLayout.astro';
import Stack from '../../components/design/Stack.astro';
import { mapStaticPathsForPaths } from '../../util/map-static-paths-for-paths';

interface Props {
  lang: LanguagesValue;
}

export async function getStaticPaths() {
  return mapStaticPathsForPaths([...SupportedLanguages]);
}

const { lang = DEFAULT_LANG } = Astro.props;

const translationSlugs = await getTranslationsUrlsForPath(lang, 'wizard');
---

<OverviewLayout
  lang={lang}
  title=`${await useUiTranslation('meta.title', lang)} | ${await useUiTranslation('meta.subtitle', lang)}`
  translationSlugs={translationSlugs}
>
  <LanguageSwitcher
    lang={lang}
    translationSlugs={translationSlugs}
  />
  <Stack>
    {
      getCanonicalUrlToKit(lang, 'affected').then((href) => (
        <CardLink
          lang={lang}
          href={href}
        >
          {useUiTranslation('wizard.areYouInDangerQuestion', lang)}
        </CardLink>
      ))
    }
    {
      getCanonicalUrlToKit(lang, 'support').then((href) => (
        <CardLink
          lang={lang}
          href={href}
        >
          {useUiTranslation('wizard.someoneElseInDangerQuestion', lang)}
        </CardLink>
      ))
    }
  </Stack>

  <MoreInfoStack
    lang={lang}
    showFlyers={true}
    showKits={false}
  />
</OverviewLayout>
