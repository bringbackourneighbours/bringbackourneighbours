---
import { type LanguagesValue } from '../../model/languages';

import ShortLink from '../design/ShortLink.astro';
import NotFoundError from '../design/NotFoundError.astro';

import { getFlatLinksEntries } from '../../util/get-flat-links-entries';
import { getCollection } from 'astro:content';

export interface Props {
  identifier: string;
  lang?: LanguagesValue;
}

const { identifier, lang = Astro.locals.lang } = Astro.props;

const link = (
  await getFlatLinksEntries(
    await getCollection('links'),
    await getCollection('flyers'),
    await getCollection('kits'),
    await getCollection('pages'),
  )
).find((links) => {
  return links?.identifier === identifier && links?.lang === lang;
});
---

{
  link?.url ? (
    <ShortLink
      lang={lang}
      openInNewTab={false}
      slug={link.slug}
      title={link.title}
      type={link.type}
      url={link.url}
    >
      <slot />
    </ShortLink>
  ) : (
    <NotFoundError context={`InternalShortLink/${identifier}/${lang}`} />
  )
}
